From ea9d0cbb413fafbd87e2fc3420c835986df8d67e Mon Sep 17 00:00:00 2001
From: Wyatt Childers <wchilders@nearce.com>
Date: Wed, 19 Jun 2019 02:23:56 -0400
Subject: [PATCH] Revert fire mechanics to 1.5.x


diff --git a/src/main/java/net/minecraft/server/BlockFire.java b/src/main/java/net/minecraft/server/BlockFire.java
index 6832a19af..52e185eba 100644
--- a/src/main/java/net/minecraft/server/BlockFire.java
+++ b/src/main/java/net/minecraft/server/BlockFire.java
@@ -95,7 +95,7 @@ public class BlockFire extends Block {
     }
 
     public int a(World world) {
-        return 30;
+        return 10;
     }
 
     public void b(World world, BlockPosition blockposition, IBlockData iblockdata, Random random) {
@@ -117,11 +117,11 @@ public class BlockFire extends Block {
                 fireExtinguished(world, blockposition); // CraftBukkit - extinguished by rain
             } else {
                 if (i < 15) {
-                    iblockdata = iblockdata.set(BlockFire.AGE, Integer.valueOf(i + random.nextInt(3) / 2));
+                    iblockdata = iblockdata.set(BlockFire.AGE, i + 1);
                     world.setTypeAndData(blockposition, iblockdata, 4);
+                    world.a(blockposition, (Block) this, this.a(world));
                 }
 
-                world.a(blockposition, (Block) this, this.a(world) + random.nextInt(10));
                 if (!flag) {
                     if (!this.c(world, blockposition)) {
                         if (!world.getType(blockposition.down()).q() || i > 3) {
@@ -137,70 +137,56 @@ public class BlockFire extends Block {
                     }
                 }
 
-                boolean flag1 = world.C(blockposition);
-                byte b0 = 0;
+                System.out.println(i);
 
-                if (flag1) {
-                    b0 = -50;
-                }
-
-                // CraftBukkit start - add source blockposition to burn calls
-                this.a(world, blockposition.east(), 300 + b0, random, i, blockposition);
-                this.a(world, blockposition.west(), 300 + b0, random, i, blockposition);
-                this.a(world, blockposition.down(), 250 + b0, random, i, blockposition);
-                this.a(world, blockposition.up(), 250 + b0, random, i, blockposition);
-                this.a(world, blockposition.north(), 300 + b0, random, i, blockposition);
-                this.a(world, blockposition.south(), 300 + b0, random, i, blockposition);
-                // CraftBukkit end
-
-                for (int j = -1; j <= 1; ++j) {
-                    for (int k = -1; k <= 1; ++k) {
-                        for (int l = -1; l <= 4; ++l) {
-                            if (j != 0 || l != 0 || k != 0) {
-                                int i1 = 100;
-
-                                if (l > 1) {
-                                    i1 += (l - 1) * 100;
-                                }
+                if (i % 2 == 0 && i > 2) {
 
-                                BlockPosition blockposition1 = blockposition.a(j, l, k);
-                                if (!world.isLoaded(blockposition1)) continue; // Paper
-                                int j1 = this.d(world, blockposition1);
+                    // CraftBukkit start - add source blockposition to burn calls
+                    this.a(world, blockposition.east(), 300, random, blockposition);
+                    this.a(world, blockposition.west(), 300, random, blockposition);
+                    this.a(world, blockposition.down(), 250, random, blockposition);
+                    this.a(world, blockposition.up(), 250, random, blockposition);
+                    this.a(world, blockposition.north(), 300, random, blockposition);
+                    this.a(world, blockposition.south(), 300, random, blockposition);
+                    // CraftBukkit end
 
-                                if (j1 > 0) {
-                                    int k1 = (j1 + 40 + world.getDifficulty().a() * 7) / (i + 30);
+                    for (int j = -1; j <= 1; ++j) {
+                        for (int k = -1; k <= 1; ++k) {
+                            for (int l = -1; l <= 4; ++l) {
+                                if (j != 0 || l != 0 || k != 0) {
+                                    int i1 = 100;
 
-                                    if (flag1) {
-                                        k1 /= 2;
+                                    if (l > 1) {
+                                        i1 += (l - 1) * 100;
                                     }
 
-                                    if (k1 > 0 && random.nextInt(i1) <= k1 && (!world.isRaining() || !this.b(world, blockposition1))) {
-                                        int l1 = i + random.nextInt(5) / 4;
-
-                                        if (l1 > 15) {
-                                            l1 = 15;
-                                        }
-
-                                        // CraftBukkit start - Call to stop spread of fire
-                                        if (world.getType(blockposition1) != Blocks.FIRE) {
-                                            if (CraftEventFactory.callBlockIgniteEvent(world, blockposition1.getX(), blockposition1.getY(), blockposition1.getZ(), blockposition.getX(), blockposition.getY(), blockposition.getZ()).isCancelled()) {
-                                                continue;
-                                            }
-
-                                            org.bukkit.Server server = world.getServer();
-                                            org.bukkit.World bworld = world.getWorld();
-                                            org.bukkit.block.BlockState blockState = bworld.getBlockAt(blockposition1.getX(), blockposition1.getY(), blockposition1.getZ()).getState();
-                                            blockState.setTypeId(Block.getId(this));
-                                            blockState.setData(new org.bukkit.material.MaterialData(Block.getId(this), (byte) l1));
-
-                                            BlockSpreadEvent spreadEvent = new BlockSpreadEvent(blockState.getBlock(), bworld.getBlockAt(blockposition.getX(), blockposition.getY(), blockposition.getZ()), blockState);
-                                            server.getPluginManager().callEvent(spreadEvent);
-
-                                            if (!spreadEvent.isCancelled()) {
-                                                blockState.update(true);
+                                    BlockPosition blockposition1 = blockposition.a(j, l, k);
+                                    if (!world.isLoaded(blockposition1)) continue; // Paper
+
+                                    int j1 = this.d(world, blockposition1);
+                                    if (j1 > 0) {
+                                        if (random.nextInt(i1) <= j1 && (!world.isRaining() || !this.b(world, blockposition1))) {
+                                            // CraftBukkit start - Call to stop spread of fire
+                                            if (world.getType(blockposition1) != Blocks.FIRE) {
+                                                if (CraftEventFactory.callBlockIgniteEvent(world, blockposition1.getX(), blockposition1.getY(), blockposition1.getZ(), blockposition.getX(), blockposition.getY(), blockposition.getZ()).isCancelled()) {
+                                                    continue;
+                                                }
+
+                                                org.bukkit.Server server = world.getServer();
+                                                org.bukkit.World bworld = world.getWorld();
+                                                org.bukkit.block.BlockState blockState = bworld.getBlockAt(blockposition1.getX(), blockposition1.getY(), blockposition1.getZ()).getState();
+                                                blockState.setTypeId(Block.getId(this));
+                                                blockState.setData(new org.bukkit.material.MaterialData(Block.getId(this)));
+
+                                                BlockSpreadEvent spreadEvent = new BlockSpreadEvent(blockState.getBlock(), bworld.getBlockAt(blockposition.getX(), blockposition.getY(), blockposition.getZ()), blockState);
+                                                server.getPluginManager().callEvent(spreadEvent);
+
+                                                if (!spreadEvent.isCancelled()) {
+                                                    blockState.update(true);
+                                                }
                                             }
+                                            // CraftBukkit end
                                         }
-                                        // CraftBukkit end
                                     }
                                 }
                             }
@@ -208,6 +194,16 @@ public class BlockFire extends Block {
                     }
                 }
 
+                if (i == 15) {
+                    // CraftBukkit start - add source blockposition to burn calls
+                    this.a(world, blockposition.east(), 1, random, blockposition);
+                    this.a(world, blockposition.west(), 1, random, blockposition);
+                    this.a(world, blockposition.down(), 1, random, blockposition);
+                    this.a(world, blockposition.up(), 1, random, blockposition);
+                    this.a(world, blockposition.north(), 1, random, blockposition);
+                    this.a(world, blockposition.south(), 1, random, blockposition);
+                    // CraftBukkit end
+                }
             }
         }
     }
@@ -232,7 +228,7 @@ public class BlockFire extends Block {
         return integer == null ? 0 : integer.intValue();
     }
 
-    private void a(World world, BlockPosition blockposition, int i, Random random, int j, BlockPosition sourceposition) { // CraftBukkit add sourceposition
+    private void a(World world, BlockPosition blockposition, int i, Random random, BlockPosition sourceposition) { // CraftBukkit add sourceposition
         // Paper start
         final IBlockData iblockdata = world.getTypeIfLoaded(blockposition);
         if (iblockdata == null) return;
@@ -253,14 +249,8 @@ public class BlockFire extends Block {
             }
             // CraftBukkit end
 
-            if (random.nextInt(j + 10) < 5 && !world.isRainingAt(blockposition)) {
-                int l = j + random.nextInt(5) / 4;
-
-                if (l > 15) {
-                    l = 15;
-                }
-
-                world.setTypeAndData(blockposition, this.getBlockData().set(BlockFire.AGE, Integer.valueOf(l)), 3);
+            if (random.nextInt(2) == 0 && !world.isRainingAt(blockposition)) {
+                world.setTypeAndData(blockposition, this.getBlockData().set(BlockFire.AGE, 0), 3);
             } else {
                 world.setAir(blockposition);
             }
@@ -331,7 +321,7 @@ public class BlockFire extends Block {
             if (!world.getType(blockposition.down()).q() && !this.c(world, blockposition)) {
                 fireExtinguished(world, blockposition); // CraftBukkit - fuel block broke
             } else {
-                world.a(blockposition, (Block) this, this.a(world) + world.random.nextInt(10));
+                world.a(blockposition, (Block) this, this.a(world));
             }
         }
     }
-- 
2.17.1

